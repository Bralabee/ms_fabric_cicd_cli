# Complete User Journey - Quick Reference
# Overview of the entire flow from zero to production deployment

id: complete-journey
title: "Complete User Journey: Zero to Production"
description: |
  A high-level roadmap of the entire Fabric CLI CI/CD workflow. Use this as a quick reference 
  to understand where you are in the process and what comes next. Each phase links to detailed 
  scenario guides for step-by-step instructions.
difficulty: beginner
estimated_duration_minutes: 5
category: overview
order: 0

prerequisites: []

learning_outcomes:
  - Understand the complete deployment lifecycle from start to finish
  - Know which scenario guide to follow for each phase
  - Identify where you are in the process and what's next
  - See the big picture before diving into details

tags:
  - overview
  - roadmap
  - quick-start
  - journey
  - lifecycle

related_scenarios:
  - getting-started
  - project-generation
  - local-deployment
  - docker-deployment
  - git-integration
  - environment-promotion

steps:
  - id: journey-overview
    title: "The Complete Journey at a Glance"
    type: info
    content: |
      ## ğŸ—ºï¸ Your Deployment Journey
      
      ```
      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
      â”‚                    PHASE 1: PREREQUISITES                       â”‚
      â”‚  Azure Setup â†’ Service Principal â†’ Fabric Capacity â†’ Tenant     â”‚
      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                    â†“
      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
      â”‚                    PHASE 2: ENVIRONMENT SETUP                   â”‚
      â”‚  Clone Repo â†’ Conda Environment â†’ Install Package â†’ .env File   â”‚
      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                    â†“
      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
      â”‚                    PHASE 3: CONFIGURATION                       â”‚
      â”‚  Choose Template â†’ Generate Config â†’ Customize YAML â†’ Validate  â”‚
      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                    â†“
      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
      â”‚                    PHASE 4: DEPLOYMENT                          â”‚
      â”‚  Deploy DEV â†’ Verify â†’ Deploy STAGING â†’ Deploy PROD             â”‚
      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                    â†“
      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
      â”‚                    PHASE 5: ONGOING OPERATIONS                  â”‚
      â”‚  Feature Branches â†’ Git Sync â†’ Monitoring â†’ Cleanup             â”‚
      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
      ```
      
      ## â±ï¸ Time Estimates
      
      | Phase | First Time | Subsequent |
      |-------|------------|------------|
      | Phase 1: Prerequisites | 30-60 min | 0 min (done once) |
      | Phase 2: Environment | 15-20 min | 2 min (activate only) |
      | Phase 3: Configuration | 10-15 min | 5 min |
      | Phase 4: Deployment | 5-10 min | 2-5 min |
      | **Total** | **60-105 min** | **10-15 min** |
    tips:
      - First-time setup takes longer but is only done once
      - After initial setup, deployments take just minutes
      - Bookmark this page as your quick reference

  - id: phase1-prerequisites
    title: "Phase 1: Prerequisites (One-Time Setup)"
    type: info
    content: |
      ## ğŸ” Azure & Fabric Prerequisites
      
      **Before you can deploy anything**, you need these Azure resources:
      
      | # | Task | Who | Time | Output |
      |---|------|-----|------|--------|
      | 1 | Create Azure Service Principal | Any Azure AD user | 5 min | `AZURE_CLIENT_ID` |
      | 2 | Create Client Secret | SP owner | 2 min | `AZURE_CLIENT_SECRET` |
      | 3 | Note Tenant ID | Any Azure AD user | 1 min | `AZURE_TENANT_ID` |
      | 4 | Get/Create Fabric Capacity | Azure Admin | 10-30 min | `FABRIC_CAPACITY_ID` |
      | 5 | Enable Fabric Tenant Settings | Fabric Admin | 5 min | API access enabled |
      
      ## âœ… Checklist: What You Need Before Proceeding
      
      ```
      â˜ AZURE_CLIENT_ID      = xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx
      â˜ AZURE_CLIENT_SECRET  = (your secret value)
      â˜ AZURE_TENANT_ID      = xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx
      â˜ FABRIC_CAPACITY_ID   = xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx
      ```
      
      ## ğŸš¨ Common Blocker
      
      **"I can't create a Service Principal"** â†’ Contact your Azure AD administrator
      **"I don't have Fabric Capacity"** â†’ Use F2 trial or contact your Azure admin
      **"Tenant settings not enabled"** â†’ Contact your Fabric administrator
      
      ğŸ“– **Detailed Guide:** [Getting Started â†’ Step 2: Azure Prerequisites](#getting-started)
    warnings:
      - "ğŸ”´ STOP: Do not proceed without all 4 credentials"
      - "These are organization-level resources - you may need admin help"

  - id: phase2-environment
    title: "Phase 2: Environment Setup"
    type: command
    content: |
      ## ğŸ› ï¸ Local Development Environment
      
      Set up your local machine to run the CLI tools.
      
      ### Quick Commands (Copy-Paste Ready)
      
      ```bash
      # 1. Clone repository (if you haven't already)
      git clone https://github.com/your-org/usf_fabric_cli_cicd.git
      cd usf_fabric_cli_cicd
      
      # 2. Create and activate conda environment
      conda env create -f environment.yml
      conda activate fabric-cli-cicd
      
      # 3. Install the package
      make install
      
      # 4. Create .env file with your credentials
      cp .env.template .env
      # Edit .env with your Azure credentials from Phase 1
      
      # 5. Verify everything works
      make diagnose
      ```
      
      ### Expected Result
      
      After `make diagnose`, you should see:
      ```
      âœ“ Fabric CLI installed
      âœ“ Credentials loaded
      âœ“ Token generation successful
      âœ“ Fabric API accessible
      âœ… All preflight checks passed!
      ```
      
      ğŸ“– **Detailed Guide:** [Getting Started â†’ Steps 3-12](#getting-started)
    code:
      language: bash
      content: |
        # Quick verification commands
        conda activate fabric-cli-cicd
        make diagnose
        python scripts/admin/utilities/list_workspaces.py
    tips:
      - "Always run `conda activate fabric-cli-cicd` before any command"
      - "If `make diagnose` fails, check your `.env` file first"

  - id: phase3-configuration
    title: "Phase 3: Generate & Validate Configuration"
    type: command
    content: |
      ## ğŸ“ Create Your Project Configuration
      
      Use blueprint templates to generate standardized configurations.
      
      ### Step 1: Choose Your Template
      
      | Template | Best For | Resources Included |
      |----------|----------|-------------------|
      | `minimal_starter` | Learning, POCs | 1 Lakehouse, 1 Notebook |
      | `basic_etl` | **Most projects** - standard ETL | 3 Lakehouses, Warehouse, Notebooks, Pipelines |
      | `realtime_streaming` | IoT, event processing | Eventstream, KQL Database, Reflex |
      | `compliance_regulated` | Healthcare, Finance, Gov | Full audit, RBAC, encryption |
      
      ### Step 2: Generate Configuration
      
      ```bash
      # Syntax: python scripts/dev/generate_project.py "OrgName" "ProjectName" --template <template>
      python scripts/dev/generate_project.py "YourOrg" "YourProject" --template basic_etl
      ```
      
      **Output Location:** `config/projects/yourorg/yourproject.yaml`
      
      > **Note:** Org and Project names are converted to lowercase, spaces become underscores
      
      ### Step 3: Key Customization Points
      
      After generation, edit these critical fields in your YAML:
      
      ```yaml
      workspace:
        name: "yourorg-yourproject"           # â† Workspace display name
        capacity_id: "${FABRIC_CAPACITY_ID}"  # â† From .env or hardcode
        git_repo: "${GIT_REPO_URL}"           # â† Optional: Azure DevOps/GitHub URL
        git_branch: "main"                    # â† Default branch
      
      principals:                              # â† Who gets workspace access
        - email: "admin@yourorg.com"
          role: "Admin"
        - email: "dev-team@yourorg.com"
          role: "Contributor"
      ```
      
      **Common Customizations:**
      - **Add Lakehouses:** Copy existing lakehouse block, change `name` and `folder`
      - **Add Notebooks:** Reference files from `templates/notebooks/`
      - **Change Capacity:** Override per environment in `environments:` section
      
      ### Step 4: Validate Configuration
      
      ```bash
      make validate config=config/projects/yourorg/yourproject.yaml
      ```
      
      This checks:
      - âœ… YAML syntax is valid
      - âœ… All required fields present
      - âœ… Environment variables are resolvable
      - âœ… Referenced files exist
      
      ğŸ“– **Detailed Guide:** [Project Generation](#project-generation) - Full template catalog and YAML reference
    code:
      language: bash
      content: |
        # Example: Generate a basic ETL project for Acme Corp
        python scripts/dev/generate_project.py "Acme Corp" "Sales Analytics" --template basic_etl
        
        # Output: config/projects/acme_corp/sales_analytics.yaml
        
        # View the generated config
        cat config/projects/acme_corp/sales_analytics.yaml
        
        # Validate before deploying
        make validate config=config/projects/acme_corp/sales_analytics.yaml
    expected_output: |
      âœ“ Configuration generated: config/projects/acme_corp/sales_analytics.yaml
      
      # Validation output:
      âœ… Configuration is valid!
      Workspace: acme-corp-sales-analytics
      Resources: 3 Lakehouses, 1 Warehouse, 3 Notebooks, 2 Pipelines
      Environment Variables: All resolved
    tips:
      - "Use `--template minimal_starter` for your first project to learn the basics"
      - "Capacity ID can be hardcoded or use `${FABRIC_CAPACITY_ID}` from .env"
      - "Always validate before deploying to catch errors early"

  - id: phase4-deployment
    title: "Phase 4: Deploy to Environments"
    type: command
    content: |
      ## ğŸš€ Deploy Your Workspace
      
      Deploy the same configuration to different environments.
      
      ### Development Deployment
      
      ```bash
      make deploy config=config/projects/acme_corp/sales_analytics.yaml env=dev
      ```
      
      ### Verify Deployment
      
      ```bash
      # Check items were created
      python scripts/admin/utilities/list_workspace_items.py --workspace "acme-corp-sales-analytics-dev"
      
      # Or open in browser
      # URL shown in deployment output
      ```
      
      ### Staging & Production (when ready)
      
      ```bash
      # Staging
      make deploy config=config/projects/acme_corp/sales_analytics.yaml env=staging
      
      # Production (after approval)
      make deploy config=config/projects/acme_corp/sales_analytics.yaml env=prod
      ```
      
      ğŸ“– **Detailed Guides:** 
      - [Local Deployment](#local-deployment)
      - [Docker Deployment](#docker-deployment) (for CI/CD)
      - [Environment Promotion](#environment-promotion)
    code:
      language: bash
      content: |
        # Deploy to dev
        make deploy config=config/projects/acme_corp/sales_analytics.yaml env=dev
        
        # Verify
        python scripts/admin/utilities/list_workspace_items.py --workspace "acme-corp-sales-analytics-dev"
    expected_output: |
      âœ“ Workspace 'acme-corp-sales-analytics-dev' created
      âœ“ Folders created: Bronze, Silver, Gold, Notebooks
      âœ“ Lakehouses created: 3
      âœ“ Notebooks created: 3
      âœ… Deployment completed successfully!
      
      Workspace URL: https://app.fabric.microsoft.com/groups/...

  - id: phase5-operations
    title: "Phase 5: Ongoing Operations"
    type: info
    content: |
      ## ğŸ”„ Day-to-Day Operations
      
      After initial deployment, you'll use these operations regularly:
      
      ### Feature Branch Development
      
      ```bash
      # Create isolated workspace for feature work
      make docker-feature-deploy config=config/projects/acme_corp/sales.yaml env=dev branch=feature/new-report
      
      # Clean up when done
      make destroy config=config/projects/acme_corp/sales.yaml env=dev
      ```
      
      ### Git Integration
      
      ```bash
      # Initialize ADO repo for Fabric Git sync
      python scripts/admin/utilities/init_ado_repo.py --organization "your-org" --project "your-project" --repository "repo-name"
      ```
      
      ### Monitoring & Troubleshooting
      
      ```bash
      # Check audit logs
      cat audit_logs/fabric_operations_$(date +%Y-%m-%d).jsonl | jq
      
      # Run diagnostics
      make diagnose
      
      # Debug ADO access
      python scripts/admin/utilities/debug_ado_access.py --organization "your-org" --project "your-project"
      ```
      
      ğŸ“– **Detailed Guides:**
      - [Feature Branch Workflows](#feature-branch-workflows)
      - [Git Integration](#git-integration)
      - [Troubleshooting](#troubleshooting)
    tips:
      - "Feature branches create temporary workspaces - remember to clean up"
      - "Audit logs are essential for compliance and debugging"
      - "Run `make diagnose` first when troubleshooting"

  - id: quick-reference-card
    title: "ğŸ“‹ Quick Reference Card"
    type: info
    content: |
      ## Essential Commands (Copy-Paste Ready)
      
      ### Environment Activation (ALWAYS FIRST!)
      ```bash
      conda activate fabric-cli-cicd
      ```
      
      ### Configuration
      ```bash
      # Generate new project
      python scripts/dev/generate_project.py "Org" "Project" --template basic_etl
      
      # Validate config
      make validate config=config/projects/org/project.yaml
      ```
      
      ### Deployment
      ```bash
      # Deploy to environment
      make deploy config=config/projects/org/project.yaml env=dev
      
      # Verify deployment
      python scripts/admin/utilities/list_workspace_items.py --workspace "workspace-name"
      
      # Destroy workspace
      make destroy config=config/projects/org/project.yaml env=dev
      ```
      
      ### Docker (for CI/CD)
      ```bash
      # Build image
      make docker-build
      
      # Deploy via Docker
      make docker-deploy config=config/projects/org/project.yaml env=dev ENVFILE=.env
      ```
      
      ### Troubleshooting
      ```bash
      # Preflight check
      make diagnose
      
      # List workspaces
      python scripts/admin/utilities/list_workspaces.py
      
      # View audit logs
      cat audit_logs/fabric_operations_$(date +%Y-%m-%d).jsonl | jq
      ```
      
      ## Scenario Guide Links
      
      | Topic | Scenario | Key Steps |
      |-------|----------|-----------|
      | Azure Setup | [Getting Started](#getting-started) | **Step 2**: Azure Prerequisites |
      | Environment | [Getting Started](#getting-started) | **Steps 3-5**: Clone, Conda, Install |
      | .env Setup | [Getting Started](#getting-started) | **Steps 9-11**: Credentials, Validation |
      | Create Configs | [Project Generation](#project-generation) | **Steps 1-6**: Templates, Generate, Edit |
      | Local Deploy | [Local Deployment](#local-deployment) | Full walkthrough |
      | CI/CD Deploy | [Docker Deployment](#docker-deployment) | Docker-based pipelines |
      | Branch Isolation | [Feature Branch Workflows](#feature-branch-workflows) | **merge-to-dev-workflow**: Complete lifecycle |
      | Version Control | [Git Integration](#git-integration) | Azure DevOps & GitHub |
      | Multi-Env | [Environment Promotion](#environment-promotion) | **Step 8**: Multiple .env files |
      | DEVâ†’TESTâ†’PROD | [Environment Promotion](#environment-promotion) | **Steps 9-12**: Promotion pipeline |
      | Problems | [Troubleshooting](#troubleshooting) | Common errors & fixes |
