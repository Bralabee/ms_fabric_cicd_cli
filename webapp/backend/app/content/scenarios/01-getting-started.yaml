# Getting Started Scenario
# Based on actual project requirements from README.md and docs/

id: getting-started
title: Getting Started with Fabric CLI CI/CD
description: Learn how to install, configure, and set up the Fabric CLI CI/CD framework from scratch. This guide covers prerequisites, environment setup, and your first successful verification.
difficulty: beginner
estimated_duration_minutes: 20
category: getting-started
order: 1

prerequisites: []

learning_outcomes:
  - Understand the framework's thin wrapper architecture
  - Install and configure the conda environment
  - Set up Azure credentials for authentication
  - Verify the installation with preflight checks
  - Understand the 12-Factor App secret management

tags:
  - installation
  - setup
  - prerequisites
  - conda
  - environment
  - credentials
  - service-principal

related_scenarios:
  - project-generation
  - local-deployment

steps:
  - id: overview
    title: What is Fabric CLI CI/CD?
    type: info
    content: |
      The **Fabric CLI CI/CD Framework** is an enterprise-grade Microsoft Fabric deployment automation tool 
      that leverages the official Fabric CLI with only ~270 lines of orchestration code.
      
      **Key Capabilities:**
      
      - **Automated Deployment**: Idempotent workspace provisioning with intelligent state management
      - **Secret Management**: 12-Factor App compliant credential handling
      - **Artifact Templating**: Jinja2 engine for environment-specific transformation
      - **Git Integration**: REST API-driven repository connections for Azure DevOps and GitHub
      - **Audit Compliance**: Structured JSONL logging for regulatory requirements
      - **Branch Isolation**: Feature branch workspaces for parallel development
      
      **Architecture Principle**: The framework follows a **thin wrapper pattern** where 90% of work 
      is done by the official Fabric CLI, with only ~270 LOC of orchestration vs traditional 
      enterprise frameworks with 1,800+ LOC.
    tips:
      - This guide assumes you're starting fresh with no prior setup
      - All commands will be run from your terminal

  - id: prerequisites-check
    title: Check Prerequisites
    type: checkpoint
    content: |
      Before proceeding, ensure you have the following installed on your system:
      
      **Required Software:**
      - Python 3.11 or higher
      - Conda (Miniconda or Anaconda)
      - Git
      - Docker (optional, for containerized deployments)
      
      **Azure Requirements:**
      - An Azure Service Principal with Fabric Admin permissions
      - Access to a Microsoft Fabric Capacity (F2 trial minimum)
      - Azure DevOps or GitHub for Git integration
      
      Let's verify your prerequisites:
    code:
      language: bash
      content: |
        # Check Python version (should be 3.11+)
        python --version
        
        # Check Conda is installed
        conda --version
        
        # Check Git is installed
        git --version
        
        # Check Docker (optional)
        docker --version
    expected_output: |
      Python 3.11.x
      conda 24.x.x
      git version 2.x.x
      Docker version 24.x.x (optional)
    checkpoint_question: Do you have Python 3.11+, Conda, and Git installed?
    warnings:
      - If Python version is below 3.11, you'll need to upgrade before continuing

  - id: clone-repository
    title: Clone the Repository
    type: command
    content: |
      First, navigate to your preferred projects directory and clone the repository.
      
      If you already have the repository, skip this step and navigate to the project folder.
    code:
      language: bash
      content: |
        # Navigate to your projects directory
        cd ~/projects
        
        # Clone the repository
        git clone <your-repo-url> usf_fabric_cli_cicd
        
        # Navigate into the project
        cd usf_fabric_cli_cicd
    tips:
      - Replace `<your-repo-url>` with your actual repository URL

  - id: create-environment
    title: Create Conda Environment
    type: command
    content: |
      The project uses a conda environment defined in `environment.yml`. This ensures 
      all team members use the same Python version and dependencies.
      
      Create and activate the environment:
    code:
      language: bash
      content: |
        # Create the conda environment from the YAML file
        conda env create -f environment.yml
        
        # Activate the environment
        conda activate fabric-cli-cicd
        
        # Verify you're in the correct environment
        conda env list
    expected_output: |
      # conda environments:
      #
      base                     /home/user/miniconda3
      fabric-cli-cicd       *  /home/user/miniconda3/envs/fabric-cli-cicd
    tips:
      - The asterisk (*) indicates the active environment
      - Always activate this environment before running any commands
    warnings:
      - Running commands without activating the environment will cause import errors

  - id: install-package
    title: Install Package in Editable Mode
    type: command
    content: |
      Install the package in editable mode to enable the CLI entry point and allow 
      live code changes during development.
    code:
      language: bash
      content: |
        # Install the package using Makefile
        make install
        
        # OR install directly with pip
        pip install -e .
        
        # Verify the CLI is available
        fabric-cicd --help
    expected_output: |
      Usage: fabric-cicd [OPTIONS] COMMAND [ARGS]...
      
      Options:
        --help  Show this message and exit.
      
      Commands:
        deploy    Deploy Fabric workspace from configuration
        destroy   Destroy Fabric workspace
        validate  Validate configuration file
    tips:
      - The `fabric-cicd` command is the main entry point
      - You can also use `python -m core.cli` as an alternative

  - id: configure-credentials
    title: Configure Credentials
    type: config
    content: |
      The framework uses the **12-Factor App** pattern for credential management 
      with a waterfall priority:
      
      1. **Environment Variables** (highest priority - for CI/CD)
      2. **`.env` file** (for local development)
      3. **Azure Key Vault** (optional - for production)
      
      Create your `.env` file from the template:
    code:
      language: bash
      content: |
        # Copy the template
        cp .env.template .env
        
        # Edit with your values
        nano .env  # or vim, code, etc.
    tips:
      - Never commit `.env` files to version control
      - The `.gitignore` already excludes `.env` files

  - id: env-variables
    title: Required Environment Variables
    type: config
    content: |
      Configure these required variables in your `.env` file:
      
      | Variable | Description | Example |
      |----------|-------------|---------|
      | `AZURE_CLIENT_ID` | Service Principal App ID | `12345678-...` |
      | `AZURE_CLIENT_SECRET` | Service Principal Secret | `xxx...` |
      | `AZURE_TENANT_ID` | Azure AD Tenant ID | `87654321-...` |
      | `FABRIC_CAPACITY_ID` | Fabric Capacity GUID | `abcd1234-...` |
      
      **Optional Git Integration:**
      
      | Variable | Description |
      |----------|-------------|
      | `AZURE_DEVOPS_PAT` | Azure DevOps Personal Access Token |
      | `GITHUB_TOKEN` | GitHub Personal Access Token |
      | `GIT_REPO_URL` | Default repository URL |
    code:
      language: dotenv
      filename: .env
      content: |
        # Azure Service Principal Credentials
        AZURE_CLIENT_ID=your-client-id
        AZURE_CLIENT_SECRET=your-client-secret
        AZURE_TENANT_ID=your-tenant-id
        
        # Fabric Configuration
        FABRIC_CAPACITY_ID=your-capacity-id
        
        # Git Integration (choose one)
        AZURE_DEVOPS_PAT=your-ado-pat
        # GITHUB_TOKEN=your-github-token
        
        # Optional: Default Git Repository
        GIT_REPO_URL=https://dev.azure.com/org/project/_git/repo
    warnings:
      - NEVER hardcode credentials in code or configuration files
      - Rotate secrets regularly for security

  - id: preflight-check
    title: Run Preflight Check
    type: command
    content: |
      The preflight check validates your entire setup: Fabric CLI installation, 
      credentials, capacity access, and network connectivity.
    code:
      language: bash
      content: |
        # Run the preflight diagnostic
        python scripts/preflight_check.py --auto-install
    expected_output: |
      âœ“ Fabric CLI installed (version x.x.x)
      âœ“ Credentials loaded from .env
      âœ“ Token generation successful
      âœ“ Fabric API accessible
      âœ“ Capacity access verified
      
      All preflight checks passed!
    tips:
      - Use `--auto-install` to automatically install Fabric CLI if missing
      - Run this check whenever you change credentials

  - id: service-principal-setup
    title: Service Principal Permissions
    type: info
    content: |
      Your Service Principal needs specific permissions for full functionality:
      
      **Fabric Permissions (in Fabric Admin Portal â†’ Tenant Settings):**
      - âœ… "Service principals can use Fabric APIs"
      - âœ… "Service principals can create workspaces"
      
      **Azure DevOps Permissions (if using Git integration):**
      - **Basic** access level in Organization Settings â†’ Users
      - **Contributor** role in the target ADO project
      - **Contribute** permission on repositories
      
      **Workspace Permissions:**
      - The Service Principal must be assigned **Admin** role in workspaces
      - This is automatically configured via the `principals` section in your YAML config
    warnings:
      - Most deployment failures are caused by missing SP permissions
      - Verify permissions before troubleshooting other issues

  - id: verify-setup
    title: Verify Complete Setup
    type: checkpoint
    content: |
      Let's verify your complete setup with a validation command:
    code:
      language: bash
      content: |
        # List available workspaces (verifies API access)
        python scripts/utilities/list_workspaces.py
        
        # Validate a sample configuration
        make validate config=templates/blueprints/minimal_starter.yaml
    expected_output: |
      Found X workspaces:
      - workspace-1
      - workspace-2
      ...
      
      Configuration valid!
    checkpoint_question: Does the preflight check pass and can you list workspaces?
    tips:
      - If list_workspaces shows 0 workspaces, that's OK for a new tenant
      - The important thing is that the API call succeeds

  - id: next-steps
    title: Next Steps
    type: info
    content: |
      ðŸŽ‰ **Congratulations!** Your Fabric CLI CI/CD environment is ready.
      
      **Recommended Next Steps:**
      
      1. **Project Generation** â†’ Learn to create configurations from blueprint templates
      2. **Local Deployment** â†’ Deploy your first workspace using the CLI
      3. **Docker Deployment** â†’ Run deployments in containerized environments
      
      **Quick Reference:**
      
      | Task | Command |
      |------|---------|
      | Generate project | `python scripts/generate_project.py "Org" "Project" --template basic_etl` |
      | Validate config | `make validate config=path/to/config.yaml` |
      | Deploy | `make deploy config=path/to/config.yaml env=dev` |
      | Preflight check | `python scripts/preflight_check.py` |
    tips:
      - Bookmark this guide for reference
      - Check the TROUBLESHOOTING.md if you encounter issues
