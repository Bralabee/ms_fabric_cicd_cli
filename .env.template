# =============================================================================
# USF Fabric CLI CI/CD — Environment Template
# =============================================================================
#
# Copy this file to .env and fill in your values:
#   cp .env.template .env
#
# NEVER commit .env — it contains real credentials.
# This template is safe to commit and share.
#
# Variable resolution:
#   ConfigManager reads ${VAR_NAME} from YAML configs and resolves them via
#   os.getenv(). Any ${VAR_NAME} in a config file can be satisfied here.
#
# Secret waterfall priority:
#   1. Environment variables (CI/CD or shell)
#   2. .env file (this file, for local development)
#   3. Azure Key Vault (optional, via AZURE_KEYVAULT_URL)
# =============================================================================


# =============================================================================
# 1. AZURE AUTHENTICATION (Required)
# =============================================================================
# Service Principal (SP) used for all Fabric API calls.
# The CLI auto-generates FABRIC_TOKEN from these credentials at runtime.
# Create an SP in Entra ID with Fabric workspace Admin permissions.

AZURE_CLIENT_ID=your_sp_app_id
AZURE_CLIENT_SECRET=your_sp_secret
AZURE_TENANT_ID=your_tenant_id

# Optional: Pre-generated Fabric bearer token (bypasses SP auth if set)
# FABRIC_TOKEN=


# =============================================================================
# 2. FABRIC INFRASTRUCTURE (Required)
# =============================================================================
# Fabric capacity ID — Get from Fabric Admin Portal → Capacity Settings
# All workspaces are created on this capacity unless overridden per stage.
FABRIC_CAPACITY_ID=your_capacity_guid

# Optional: Separate capacities for Test / Prod stages.
# If unset, both stages fall back to FABRIC_CAPACITY_ID.
# TEST_CAPACITY_ID=
# PROD_CAPACITY_ID=


# =============================================================================
# 3. GIT INTEGRATION (Required)
# =============================================================================
# One of GITHUB_TOKEN or AZURE_DEVOPS_PAT is required for Git connections.

# GitHub Personal Access Token — must have repo + admin:org scope
GITHUB_TOKEN=ghp_your_token_here

# Git repo URL — used in workspace YAML configs as ${GIT_REPO_URL}
GIT_REPO_URL=https://github.com/your-org/your-repo.git

# Azure DevOps PAT (alternative to GITHUB_TOKEN)
# AZURE_DEVOPS_PAT=


# =============================================================================
# 4. GOVERNANCE PRINCIPALS (Required)
# =============================================================================
# These security groups are AUTO-INJECTED into every workspace by ConfigManager.
# They enforce organisation-wide governance regardless of project config.
#
# How it works:
#   ConfigManager._to_workspace_config() reads these two env vars and appends
#   them to the principals list of every workspace it processes.
#   You do NOT need to list them in YAML configs (though doing so is harmless).

# IT Admin security group — injected as Admin role on every workspace
ADDITIONAL_ADMIN_PRINCIPAL_ID=your_admin_security_group_oid

# Support / Contributor security group — injected as Contributor on every workspace
ADDITIONAL_CONTRIBUTOR_PRINCIPAL_ID=your_contributor_security_group_oid


# =============================================================================
# 5. PROJECT-SPECIFIC PRINCIPALS
# =============================================================================
# Each data product (project) has its own Admin / Member env vars.
# These are referenced in YAML configs as ${<PROJECT>_ADMIN_ID} etc.
#
# Naming convention:
#   <PROJECT>_ADMIN_ID    — comma-separated GUIDs → each gets Admin role
#   <PROJECT>_MEMBERS_ID  — comma-separated GUIDs → each gets Member role
#
# The CLI splits comma-separated values automatically:
#   EDP_ADMIN_ID=guid1,guid2 → two separate Admin principal entries
#
# ─── Adding a new project ────────────────────────────────────────────────────
# 1. Create config/projects/<project>/ in your consumer repo
# 2. Add the env vars below with the new project prefix
# 3. Reference them in YAML as ${NEWPROJECT_ADMIN_ID}, ${NEWPROJECT_MEMBERS_ID}
# 4. Add matching GitHub Secrets in the consumer repo (for CI/CD)
# ─────────────────────────────────────────────────────────────────────────────

# ── EDP (Enterprise Data Platform) ──────────────────────────────────────────
EDP_ADMIN_ID=your_edp_admin_oid
EDP_MEMBERS_ID=oid1,oid2,oid3

# ── RE Sales (Direct Sales Helicopter View) ─────────────────────────────────
RE_SALES_ADMIN_ID=your_re_sales_admin_oid
RE_SALES_MEMBERS_ID=oid1,oid2,oid3

# ── Template — copy and rename for each new project ─────────────────────────
# NEWPROJECT_ADMIN_ID=
# NEWPROJECT_MEMBERS_ID=


# =============================================================================
# 6. WORKSPACE & DOMAIN (Optional)
# =============================================================================
# PROJECT_PREFIX is used in YAML configs for workspace naming:
#   workspace.name: ${PROJECT_PREFIX}-dev
# In GitHub Actions this is set dynamically per workflow run.
# For local development, set it to the project you're working on.
# PROJECT_PREFIX=edp

# Fabric domain assignment (e.g. "Sales", "Finance", "Engineering")
# If unset or unresolved, the CLI skips domain assignment with a warning.
# FABRIC_DOMAIN_NAME=

# Deployment Pipeline name override (auto-derived from config if not set)
# FABRIC_PIPELINE_NAME=


# =============================================================================
# 7. ADVANCED / OPTIONAL
# =============================================================================
# Azure Key Vault URL — third tier of the secrets waterfall
# AZURE_KEYVAULT_URL=https://your-kv.vault.azure.net/

# Azure subscription (used by some admin scripts)
# AZURE_SUBSCRIPTION_ID=

# Storage account URL — available in Jinja2 templates as {{ secrets.STORAGE_ACCOUNT_URL }}
# STORAGE_ACCOUNT_URL=

# Logging
LOG_LEVEL=INFO
AUDIT_LOG_DIR=audit_logs

# Organisation name (used by onboarding scripts)
# ORGANIZATION_NAME=

# Telemetry (JSONL usage logging to audit_logs/)
# FABRIC_TELEMETRY_MAX_MB=50
# DISABLE_FABRIC_TELEMETRY=1
