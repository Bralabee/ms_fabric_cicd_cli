# ─────────────────────────────────────────────────────────────────────────────
# Migration & Hybrid Architecture Workspace Configuration Template
# Optimized for: Cloud migration, hybrid on-prem/cloud, multi-cloud integration
# Use Cases: Lift-and-shift, incremental migration, legacy modernization
# Strategy: Git-sync-only — Fabric items managed through Git, not CLI
#
# MIGRATION STRATEGY:
#   Phase 1: Mirror legacy systems into Fabric (coexistence)
#   Phase 2: Transform schemas to cloud-native models
#   Phase 3: Cutover with automated rollback capability
#   Phase 4: Decommission legacy, optimize cloud-native
# ─────────────────────────────────────────────────────────────────────────────

workspace:
  name: "migration-workspace"         # ← CHANGE: Your project workspace name
  display_name: "Hybrid Migration Platform"
  description: "Bridge between legacy systems and modern cloud analytics"
  capacity_id: "${FABRIC_CAPACITY_ID}"
  domain: "${FABRIC_DOMAIN_NAME}"

  # Git Integration
  git_repo: "${GIT_REPO_URL}"
  git_branch: "main"
  git_directory: "/"

environments:
  dev:
    workspace:
      name: "migration-workspace"
      capacity_id: "${FABRIC_CAPACITY_ID}"
  test:
    workspace:
      capacity_id: "${FABRIC_CAPACITY_ID}"
  prod:
    workspace:
      capacity_id: "${FABRIC_CAPACITY_ID}"

# ── Folder Structure (Numbered Convention) ───────────────────────────────────
folders:
  - "000 Orchestrate"
  - "100 Ingest"
  - "200 Store"
  - "300 Prepare"
  - "400 Model"
  - "500 Visualize"
  - "999 Libraries"
  - "Archive"

# ── Folder Rules (Post-Git-Sync Item Placement) ─────────────────────────────
folder_rules:
  - type: DataPipeline
    folder: "000 Orchestrate"
  - type: DataflowGen2
    folder: "000 Orchestrate"
  - type: Eventstream
    folder: "100 Ingest"
  - type: Lakehouse
    folder: "200 Store"
  - type: Notebook
    folder: "300 Prepare"
  - type: SparkJobDefinition
    folder: "300 Prepare"
  - type: Warehouse
    folder: "400 Model"
  - type: SemanticModel
    folder: "400 Model"
  - type: Report
    folder: "500 Visualize"
  - type: Dashboard
    folder: "500 Visualize"
  - type: Environment
    folder: "999 Libraries"

# ── No Fabric Items — Content Managed Through Git Sync ───────────────────────
# Typical Git-managed items for a migration project:
#   - MirroredDatabase: onprem_erp (100 Ingest) — SQL Server mirror
#   - MirroredDatabase: azure_sql_db (100 Ingest) — Azure SQL mirror
#   - MirroredDatabase: snowflake_dw (100 Ingest) — multi-cloud mirror
#   - MirroredWarehouse: synapse_dw (100 Ingest) — Synapse migration
#   - MountedDataFactory: legacy_adf (000 Orchestrate) — existing ADF
#   - Lakehouse: legacy_landing (200 Store) — raw from on-prem systems
#   - Lakehouse: migration_staging (200 Store) — validation staging area
#   - Lakehouse: modernized_data (200 Store) — cloud-native target
#   - Warehouse: legacy_compat_dw (400 Model) — backward-compatible
#   - Warehouse: modern_analytics_dw (400 Model) — target architecture
#   - Notebook: schema_mapper (300 Prepare) — legacy → modern schema
#   - Notebook: migration_validator (300 Prepare) — data accuracy checks
#   - Notebook: incremental_migrator (300 Prepare) — batch migration
#   - Notebook: performance_comparator (300 Prepare) — legacy vs modern
#   - Pipeline: phase1_lift_and_shift (000 Orchestrate)
#   - Pipeline: phase2_modernization (000 Orchestrate)
#   - Pipeline: phase3_cutover (000 Orchestrate)
#   - Pipeline: hybrid_sync (000 Orchestrate) — ongoing during transition
#   - SemanticModel: unified_reporting (400 Model) — both legacy and modern
#   - Connection: onprem_sql (999 Libraries) — gateway connection
#   - Connection: snowflake (999 Libraries) — multi-cloud connection
#   - Report: migration_progress (500 Visualize)
# ─────────────────────────────────────────────────────────────────────────────
lakehouses: []
notebooks: []
resources: []

# ── Access Control ───────────────────────────────────────────────────────────
principals:
  # 1. Automation Service Principal (runs deployments)
  - id: "${AZURE_CLIENT_ID}"
    role: Contributor
    description: "Automation SP — required for CI/CD deployments"

  # 2. Mandatory Admin security group (IT governance)
  - id: "${ADDITIONAL_ADMIN_PRINCIPAL_ID}"
    role: Admin
    description: "Mandatory governance admin group"

  # 3. Mandatory Contributor security group (support team)
  - id: "${ADDITIONAL_CONTRIBUTOR_PRINCIPAL_ID}"
    role: Contributor
    description: "Mandatory governance contributor group"

  # ── Project-specific principals ────────────────────────────────────────────
  - id: "${PROJECT_ADMIN_ID}"               # ← CHANGE
    role: Admin
    description: "Migration program manager"

  - id: "${PROJECT_MEMBERS_ID}"             # ← CHANGE
    role: Member
    description: "Migration engineering team"

  # Optional: Legacy system admins (transitional access)
  # - id: "${LEGACY_ADMINS_ID}"
  #   role: Contributor
  #   description: "Legacy system admins — transitional support"

  # Optional: Business validation team
  # - id: "${VALIDATION_TEAM_ID}"
  #   role: Viewer
  #   description: "Business users — validate migrated data"

# ── Deployment Pipeline ──────────────────────────────────────────────────────
deployment_pipeline:
  pipeline_name: "migration-pipeline"    # ← CHANGE
  stages:
    development:
      workspace_name: "migration-workspace"
      capacity_id: "${FABRIC_CAPACITY_ID}"
    test:
      workspace_name: "migration-workspace [Test]"
      capacity_id: "${FABRIC_CAPACITY_ID}"
    production:
      workspace_name: "migration-workspace [Production]"
      capacity_id: "${FABRIC_CAPACITY_ID}"

# MIGRATION PLANNING GUIDANCE:
# ─────────────────────────────────────────────────────────────────────────────
# Phase 1 — Lift & Shift (Weeks 1-4):
#   - Mirror on-prem databases to Fabric via MirroredDatabase
#   - Replicate legacy warehouse structure
#   - Parallel run: legacy + cloud (validate data consistency)
#
# Phase 2 — Schema Modernization (Weeks 5-8):
#   - Transform legacy schemas to medallion/star schema
#   - Optimize for cloud performance
#   - Maintain backward-compatible view layer
#
# Phase 3 — Cutover (Weeks 9-12):
#   - Blue/green deployment strategy
#   - Redirect users to modern platform
#   - Keep legacy as fallback (2 weeks)
#
# Phase 4 — Optimization (Weeks 13-16):
#   - Remove backward compatibility layers
#   - Optimize cloud-native performance
#   - Decommission legacy systems
#
# Rollback Strategy:
#   - MirroredDatabases enable instant rollback to on-prem
#   - Automated data drift detection
#   - Rollback SLA: <1 hour to revert to legacy
#
# Supported Source Systems:
#   - SQL Server (on-prem via Gateway)
#   - Azure SQL Database
#   - Snowflake (multi-cloud)
#   - Azure Synapse (Dedicated SQL Pool)
#   - Azure Data Factory (mount existing pipelines)
