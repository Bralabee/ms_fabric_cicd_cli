# ─────────────────────────────────────────────────────────────────────────────
# Extensive Example Workspace Configuration Template
# Purpose: Demonstrates the FULL configuration schema with all options
# Use Cases: Reference documentation, learning the config format
# Strategy: Git-sync-only — Fabric items managed through Git, not CLI
#
# This template shows every supported configuration option with detailed
# comments. Use it as a reference when building your own project configs.
# For production use, start with a purpose-specific template instead.
# ─────────────────────────────────────────────────────────────────────────────

workspace:
  name: "enterprise-analytics-hub"    # ← CHANGE: Workspace name (DNS-safe)
  display_name: "Enterprise Analytics Hub"
  description: "Centralized analytics platform for cross-functional data products"
  capacity_id: "${FABRIC_CAPACITY_ID}" # Env var — set in .env or CI/CD secrets
  domain: "${FABRIC_DOMAIN_NAME}"      # Optional: Assign to a Fabric Domain

  # Git Integration (connects workspace to version control)
  git_repo: "${GIT_REPO_URL}"          # Env var — GitHub/ADO repo URL
  git_branch: "main"                   # Branch to sync with
  git_directory: "/"                   # Root of Fabric items in repo

# ── Environment-Specific Overrides ───────────────────────────────────────────
# Override workspace properties per environment. Deep-merged with base config.
# ─────────────────────────────────────────────────────────────────────────────
environments:
  dev:
    workspace:
      name: "enterprise-analytics-hub"
      capacity_id: "${FABRIC_CAPACITY_ID}"
  test:
    workspace:
      capacity_id: "${FABRIC_CAPACITY_ID}"
  prod:
    workspace:
      capacity_id: "${FABRIC_CAPACITY_ID}"

# ── Folder Structure (Numbered Convention) ───────────────────────────────────
# Standard numbered folders for consistent workspace organization.
# All workspaces — Dev, Test, Prod, Feature — use the same structure.
# ─────────────────────────────────────────────────────────────────────────────
folders:
  - "000 Orchestrate"   # Pipelines, DataflowGen2 — workflow orchestration
  - "100 Ingest"        # Eventstreams, Reflex — data ingestion and alerting
  - "200 Store"         # Lakehouses, KQL Databases — data storage
  - "300 Prepare"       # Notebooks, Spark Jobs — data transformation
  - "400 Model"         # Warehouses, Semantic Models — data modeling and BI
  - "500 Visualize"     # Reports, Dashboards — data visualization
  - "999 Libraries"     # Environments — shared Spark/Python libraries
  - "Archive"           # Deprecated or retired items

# ── Folder Rules (Post-Git-Sync Item Placement) ─────────────────────────────
# Fabric Git Sync always places items at the workspace root. After sync
# completes, `fabric-cicd organize-folders` uses these rules to move items
# into their designated folders. Runs automatically in CI/CD workflows.
# ─────────────────────────────────────────────────────────────────────────────
folder_rules:
  - type: DataPipeline       # Data Factory pipelines
    folder: "000 Orchestrate"
  - type: DataflowGen2       # Dataflow Gen2 items
    folder: "000 Orchestrate"
  - type: Eventstream        # Real-time event ingestion
    folder: "100 Ingest"
  - type: Lakehouse          # Delta Lake storage
    folder: "200 Store"
  - type: Notebook           # PySpark/Scala notebooks
    folder: "300 Prepare"
  - type: SparkJobDefinition # Spark batch jobs
    folder: "300 Prepare"
  - type: Warehouse          # T-SQL data warehouses
    folder: "400 Model"
  - type: SemanticModel      # Power BI semantic models (datasets)
    folder: "400 Model"
  - type: Report             # Power BI reports
    folder: "500 Visualize"
  - type: Dashboard          # Power BI dashboards
    folder: "500 Visualize"
  - type: Environment        # Spark/Python environment configs
    folder: "999 Libraries"

# ── No Fabric Items — Content Managed Through Git Sync ───────────────────────
#
# WHY EMPTY LISTS?
# Items (lakehouses, notebooks, warehouses, etc.) are version-controlled in
# Git and synced into the workspace via Fabric Git Sync. The CLI manages
# workspace structure, folders, access control, and deployment pipelines —
# NOT individual Fabric items.
#
# HOW IT WORKS:
#   1. Developer creates items in Dev workspace (Fabric portal or API)
#   2. Items are committed to Git via Fabric Git Sync
#   3. Feature merge to `main` → Dev workspace auto-syncs
#   4. `fabric-cicd promote` pushes content Dev → Test → Prod
#   5. `fabric-cicd organize-folders` moves items per folder_rules
#
# EXAMPLE ITEMS (what your Git repo would contain):
#   - Lakehouse: raw_landing_zone (200 Store)
#   - Lakehouse: enriched_data_zone (200 Store)
#   - Warehouse: enterprise_dw (400 Model)
#   - Notebook: ingest_sales_data (300 Prepare)
#   - Notebook: transform_customer_dim (300 Prepare)
#   - Pipeline: daily_etl_orchestrator (000 Orchestrate)
#   - SemanticModel: sales_performance (400 Model)
#   - Eventstream: iot_telemetry (100 Ingest)
#   - KQLDatabase: log_analytics (200 Store)
#   - Environment: spark_env (999 Libraries)
#   - Report: executive_dashboard (500 Visualize)
# ─────────────────────────────────────────────────────────────────────────────
lakehouses: []
notebooks: []
resources: []

# ── Access Control ───────────────────────────────────────────────────────────
# IMPORTANT: Use Object IDs (GUIDs), not email addresses.
# The 'id' field supports comma-separated lists for bulk assignment:
#   id: "guid1,guid2,guid3" → each gets the specified role.
# Use environment variables to inject secrets at runtime.
# ─────────────────────────────────────────────────────────────────────────────
principals:
  # ── Mandatory Governance Principals (every workspace must have these) ──────
  # 1. Automation Service Principal (runs deployments)
  - id: "${AZURE_CLIENT_ID}"
    role: Contributor
    description: "Automation SP — required for CI/CD deployments"

  # 2. Mandatory Admin security group (IT governance)
  - id: "${ADDITIONAL_ADMIN_PRINCIPAL_ID}"
    role: Admin
    description: "Mandatory governance admin group"

  # 3. Mandatory Contributor security group (support team)
  - id: "${ADDITIONAL_CONTRIBUTOR_PRINCIPAL_ID}"
    role: Contributor
    description: "Mandatory governance contributor group"

  # ── Project-specific principals (runtime-configurable via env vars) ────────
  - id: "${PROJECT_ADMIN_ID}"               # ← CHANGE: Your admin secret name
    role: Admin
    description: "Project workspace admins"

  - id: "${PROJECT_MEMBERS_ID}"             # ← CHANGE: Your member secret name
    role: Member
    description: "Project team members (developers, engineers)"

  # Optional: Read-only access for report consumers
  # - id: "${PROJECT_VIEWERS_ID}"
  #   role: Viewer
  #   description: "Report consumers and analysts — read-only"

# ── Deployment Pipeline ──────────────────────────────────────────────────────
# Connects Dev → Test → Prod workspaces for content promotion.
# Created automatically by `fabric-cicd deploy` during initial setup.
#
# Promotion flow:
#   1. Dev workspace auto-syncs from `main` branch (Git Sync)
#   2. Push to main → GitHub Actions `promote-dev-to-test.yml` (automatic)
#   3. Manual trigger → `promote-test-to-prod.yml` (with approval gate)
# ─────────────────────────────────────────────────────────────────────────────
deployment_pipeline:
  pipeline_name: "enterprise-analytics-pipeline"  # ← CHANGE
  stages:
    development:
      workspace_name: "enterprise-analytics-hub"
      capacity_id: "${FABRIC_CAPACITY_ID}"
    test:
      workspace_name: "enterprise-analytics-hub [Test]"
      capacity_id: "${FABRIC_CAPACITY_ID}"
    production:
      workspace_name: "enterprise-analytics-hub [Production]"
      capacity_id: "${FABRIC_CAPACITY_ID}"

# ─────────────────────────────────────────────────────────────────────────────
# CONFIGURATION REFERENCE
# ─────────────────────────────────────────────────────────────────────────────
#
# ENVIRONMENT VARIABLES (set in .env, CI/CD secrets, or Key Vault):
#   FABRIC_CAPACITY_ID          — Fabric capacity GUID
#   FABRIC_DOMAIN_NAME          — Optional Fabric Domain name
#   GIT_REPO_URL                — GitHub/ADO repository URL
#   AZURE_CLIENT_ID             — Service Principal app ID
#   AZURE_CLIENT_SECRET         — Service Principal secret
#   AZURE_TENANT_ID             — Entra ID tenant
#   ADDITIONAL_ADMIN_PRINCIPAL_ID       — Mandatory admin group GUID
#   ADDITIONAL_CONTRIBUTOR_PRINCIPAL_ID — Mandatory contributor group GUID
#   PROJECT_ADMIN_ID            — Project-specific admin GUID(s)
#   PROJECT_MEMBERS_ID          — Project-specific member GUID(s)
#
# SUPPORTED FABRIC ITEM TYPES (for folder_rules):
#   DataPipeline, DataflowGen2, Eventstream, Lakehouse, Notebook,
#   SparkJobDefinition, Warehouse, SemanticModel, Report, Dashboard,
#   Environment, KQLDatabase, KQLQueryset, Reflex, GraphQLApi,
#   MirroredDatabase, MirroredWarehouse, MountedDataFactory,
#   ExternalDataShare, Connection, Gateway, MLModel, MLExperiment
#
# CLI COMMANDS:
#   fabric-cicd deploy <config> --env dev       # Create workspace + pipeline
#   fabric-cicd destroy <config>                # Remove workspace
#   fabric-cicd promote --pipeline-name <name>  # Promote between stages
#   fabric-cicd organize-folders <config>       # Apply folder_rules
#   fabric-cicd validate <config>               # Validate config syntax
