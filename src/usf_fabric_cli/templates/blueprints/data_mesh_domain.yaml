# ─────────────────────────────────────────────────────────────────────────────
# Data Mesh Domain Workspace Configuration Template
# Optimized for: Decentralized data ownership, domain-driven data products
# Use Cases: Enterprise data mesh, domain teams, cross-domain data sharing
# Strategy: Git-sync-only — Fabric items managed through Git, not CLI
#
# DATA MESH PRINCIPLES:
#   1. Domain Ownership: Each domain team owns their workspace and data products
#   2. Data as a Product: Published, discoverable, quality-guaranteed datasets
#   3. Self-Serve Platform: Standardized workspace template, reusable patterns
#   4. Federated Governance: Central audit access, domain-level control
# ─────────────────────────────────────────────────────────────────────────────

workspace:
  name: "domain-workspace"            # ← CHANGE: e.g., "sales-domain", "customer-domain"
  display_name: "Domain Data Products"
  description: "Domain-owned data product workspace with cross-domain sharing"
  capacity_id: "${FABRIC_CAPACITY_ID}"
  domain: "${FABRIC_DOMAIN_NAME}"     # Use Fabric Domains to group related workspaces

  # Git Integration
  git_repo: "${GIT_REPO_URL}"
  git_branch: "main"
  git_directory: "/"

environments:
  dev:
    workspace:
      name: "domain-workspace"
      capacity_id: "${FABRIC_CAPACITY_ID}"
  test:
    workspace:
      capacity_id: "${FABRIC_CAPACITY_ID}"
  prod:
    workspace:
      capacity_id: "${FABRIC_CAPACITY_ID}"

# ── Folder Structure (Numbered Convention) ───────────────────────────────────
folders:
  - "000 Orchestrate"
  - "100 Ingest"
  - "200 Store"
  - "300 Prepare"
  - "400 Model"
  - "500 Visualize"
  - "999 Libraries"
  - "Archive"

# ── Folder Rules (Post-Git-Sync Item Placement) ─────────────────────────────
folder_rules:
  - type: DataPipeline
    folder: "000 Orchestrate"
  - type: DataflowGen2
    folder: "000 Orchestrate"
  - type: Eventstream
    folder: "100 Ingest"
  - type: Lakehouse
    folder: "200 Store"
  - type: Notebook
    folder: "300 Prepare"
  - type: SparkJobDefinition
    folder: "300 Prepare"
  - type: Warehouse
    folder: "400 Model"
  - type: SemanticModel
    folder: "400 Model"
  - type: Report
    folder: "500 Visualize"
  - type: Dashboard
    folder: "500 Visualize"
  - type: Environment
    folder: "999 Libraries"

# ── No Fabric Items — Content Managed Through Git Sync ───────────────────────
# Typical Git-managed items for a data mesh domain workspace:
#   - Lakehouse: source_data (200 Store) — raw domain data
#   - Lakehouse: aggregated_products (200 Store) — published data products
#   - Lakehouse: consumer_views (200 Store) — cross-domain shared datasets
#   - Warehouse: domain_dw (400 Model) — domain star schema
#   - Notebook: source_ingestion (300 Prepare) — ingest from domain sources
#   - Notebook: product_builder (300 Prepare) — build data products
#   - Notebook: quality_checks (300 Prepare) — enforce SLA/quality contracts
#   - Pipeline: product_refresh (000 Orchestrate) — data product pipeline
#   - Pipeline: cross_domain_publish (000 Orchestrate) — share to consumers
#   - SemanticModel: domain_analytics (400 Model) — certified model
#   - GraphQLApi: domain_data_api (400 Model) — self-service data access
#   - MirroredDatabase: external_source (100 Ingest) — cross-domain mirror
#   - ExternalDataShare: share_products (400 Model) — data sharing
#   - Report: domain_dashboard (500 Visualize)
# ─────────────────────────────────────────────────────────────────────────────
lakehouses: []
notebooks: []
resources: []

# ── Access Control (Domain Ownership) ────────────────────────────────────────
principals:
  # 1. Automation Service Principal (runs deployments)
  - id: "${AZURE_CLIENT_ID}"
    role: Contributor
    description: "Automation SP — required for CI/CD deployments"

  # 2. Mandatory Admin security group (IT governance)
  - id: "${ADDITIONAL_ADMIN_PRINCIPAL_ID}"
    role: Admin
    description: "Mandatory governance admin group"

  # 3. Mandatory Contributor security group (support team)
  - id: "${ADDITIONAL_CONTRIBUTOR_PRINCIPAL_ID}"
    role: Contributor
    description: "Mandatory governance contributor group"

  # ── Domain-specific principals ─────────────────────────────────────────────
  # Domain owner (product manager / data owner)
  - id: "${PROJECT_ADMIN_ID}"               # ← CHANGE
    role: Admin
    description: "Domain owner — accountable for data products"

  # Domain data engineers
  - id: "${PROJECT_MEMBERS_ID}"             # ← CHANGE
    role: Member
    description: "Domain data engineering team"

  # Cross-domain consumers (read-only access to published data products)
  # - id: "${CONSUMER_DOMAIN_1_ID}"
  #   role: Viewer
  #   description: "Marketing domain — consumer of published data products"
  # - id: "${CONSUMER_DOMAIN_2_ID}"
  #   role: Viewer
  #   description: "Finance domain — consumer of published data products"

  # Central governance (audit access)
  # - id: "${CENTRAL_GOVERNANCE_ID}"
  #   role: Viewer
  #   description: "Central data governance — audit and compliance oversight"

# ── Deployment Pipeline ──────────────────────────────────────────────────────
deployment_pipeline:
  pipeline_name: "domain-pipeline"       # ← CHANGE: e.g., "sales-domain-pipeline"
  stages:
    development:
      workspace_name: "domain-workspace"
      capacity_id: "${FABRIC_CAPACITY_ID}"
    test:
      workspace_name: "domain-workspace [Test]"
      capacity_id: "${FABRIC_CAPACITY_ID_TEST:-FABRIC_CAPACITY_ID}"
    production:
      workspace_name: "domain-workspace [Production]"
      capacity_id: "${FABRIC_CAPACITY_ID_PROD:-FABRIC_CAPACITY_ID}"

# DATA MESH IMPLEMENTATION GUIDANCE:
# ─────────────────────────────────────────────────────────────────────────────
# Domain Workspace Pattern:
#   - Clone this template for each business domain (Sales, Customer, Finance)
#   - Each domain owns its workspace, data, and data products
#   - Use Fabric Domains to group related workspaces visually
#
# Data Product Publishing:
#   - Build certified data products in "aggregated_products" lakehouse
#   - Publish discoverable datasets via GraphQL API or External Data Share
#   - Define quality contracts (SLA, freshness, completeness)
#   - Register products in Microsoft Purview for discoverability
#
# Cross-Domain Integration:
#   - Use MirroredDatabase to consume data from other domains
#   - Avoids tight coupling between domain workspaces
#   - GraphQL API enables REST-like self-service consumption
#
# Governance Model:
#   - Domain teams own their data (Admin/Contributor roles)
#   - Central governance has Viewer access for audit
#   - Quality gates enforced via automated notebooks
