# ─────────────────────────────────────────────────────────────────────────────
# Compliance & Regulated Industry Workspace Configuration Template
# Optimized for: HIPAA, SOX, GDPR, PCI-DSS, financial regulatory compliance
# Use Cases: Healthcare analytics, financial reporting, audit-ready platforms
# Strategy: Git-sync-only — Fabric items managed through Git, not CLI
#
# COMPLIANCE NOTES:
#   - Strict RBAC: Separation of duties enforced via distinct principal roles
#   - Audit trail: All changes tracked through Git and Fabric audit logs
#   - Data classification: Use folder naming to indicate sensitivity levels
#   - Encryption: Fabric provides encryption at rest and in transit by default
# ─────────────────────────────────────────────────────────────────────────────

workspace:
  name: "compliance-workspace"        # ← CHANGE: Your project workspace name
  display_name: "Compliance Analytics Platform"
  description: "Regulated data platform with strict access controls and audit trails"
  capacity_id: "${FABRIC_CAPACITY_ID}"
  domain: "${FABRIC_DOMAIN_NAME}"

  # Git Integration (required for audit trail)
  git_repo: "${GIT_REPO_URL}"
  git_branch: "main"
  git_directory: "/"

environments:
  dev:
    workspace:
      name: "compliance-workspace"
      capacity_id: "${FABRIC_CAPACITY_ID}"
  test:
    workspace:
      capacity_id: "${FABRIC_CAPACITY_ID}"
  prod:
    workspace:
      capacity_id: "${FABRIC_CAPACITY_ID}"

# ── Folder Structure (Numbered Convention) ───────────────────────────────────
# Standard numbered folders apply. Use Purview sensitivity labels for data
# classification rather than folder names.
# ─────────────────────────────────────────────────────────────────────────────
folders:
  - "000 Orchestrate"
  - "100 Ingest"
  - "200 Store"
  - "300 Prepare"
  - "400 Model"
  - "500 Visualize"
  - "999 Libraries"
  - "Archive"

# ── Folder Rules (Post-Git-Sync Item Placement) ─────────────────────────────
folder_rules:
  - type: DataPipeline
    folder: "000 Orchestrate"
  - type: DataflowGen2
    folder: "000 Orchestrate"
  - type: Eventstream
    folder: "100 Ingest"
  - type: Lakehouse
    folder: "200 Store"
  - type: Notebook
    folder: "300 Prepare"
  - type: SparkJobDefinition
    folder: "300 Prepare"
  - type: Warehouse
    folder: "400 Model"
  - type: SemanticModel
    folder: "400 Model"
  - type: Report
    folder: "500 Visualize"
  - type: Dashboard
    folder: "500 Visualize"
  - type: Environment
    folder: "999 Libraries"

# ── No Fabric Items — Content Managed Through Git Sync ───────────────────────
# Typical Git-managed items for a compliance-regulated project:
#   - Lakehouse: restricted_data (200 Store) — PII/PHI data, row-level security
#   - Lakehouse: confidential_analytics (200 Store) — aggregated, de-identified
#   - Lakehouse: audit_data (200 Store) — immutable audit trail records
#   - Warehouse: compliance_dw (400 Model) — regulatory reporting warehouse
#   - Notebook: data_classification (300 Prepare) — auto-classify sensitivity
#   - Notebook: pii_masking (300 Prepare) — mask/tokenize PII/PHI
#   - Notebook: audit_report_generator (300 Prepare) — compliance reports
#   - Notebook: data_retention_enforcer (300 Prepare) — retention policies
#   - Pipeline: compliance_etl (000 Orchestrate) — audited data pipeline
#   - Pipeline: retention_enforcement (000 Orchestrate) — data lifecycle
#   - SemanticModel: regulatory_reporting_model (400 Model) — certified
#   - Environment: compliance_env (999 Libraries) — approved libraries
#   - Report: compliance_dashboard (500 Visualize)
# ─────────────────────────────────────────────────────────────────────────────
lakehouses: []
notebooks: []
resources: []

# ── Access Control (Strict RBAC) ─────────────────────────────────────────────
# Compliance workspaces require separation of duties:
#   - Admins: Platform team only (not data engineers)
#   - Contributors: Data engineers (cannot change access)
#   - Viewers: Auditors and compliance officers (read-only)
# ─────────────────────────────────────────────────────────────────────────────
principals:
  # 1. Automation Service Principal (runs deployments)
  - id: "${AZURE_CLIENT_ID}"
    role: Contributor
    description: "Automation SP — required for CI/CD deployments"

  # 2. Mandatory Admin security group (IT governance)
  - id: "${ADDITIONAL_ADMIN_PRINCIPAL_ID}"
    role: Admin
    description: "Mandatory governance admin group"

  # 3. Mandatory Contributor security group (support team)
  - id: "${ADDITIONAL_CONTRIBUTOR_PRINCIPAL_ID}"
    role: Contributor
    description: "Mandatory governance contributor group"

  # ── Project-specific principals (separation of duties) ────────────────────
  - id: "${PROJECT_ADMIN_ID}"               # ← CHANGE
    role: Admin
    description: "Platform admins — workspace and security management"

  - id: "${PROJECT_MEMBERS_ID}"             # ← CHANGE
    role: Member
    description: "Data engineers — build and maintain data pipelines"

  # Compliance / Audit team — read-only access for auditing
  - id: "${COMPLIANCE_AUDITORS_ID}"         # ← CHANGE
    role: Viewer
    description: "Compliance officers and auditors — read-only audit access"

# ── Deployment Pipeline ──────────────────────────────────────────────────────
deployment_pipeline:
  pipeline_name: "compliance-pipeline"   # ← CHANGE
  stages:
    development:
      workspace_name: "compliance-workspace"
      capacity_id: "${FABRIC_CAPACITY_ID}"
    test:
      workspace_name: "compliance-workspace [Test]"
      capacity_id: "${FABRIC_CAPACITY_ID_TEST:-FABRIC_CAPACITY_ID}"
    production:
      workspace_name: "compliance-workspace [Production]"
      capacity_id: "${FABRIC_CAPACITY_ID_PROD:-FABRIC_CAPACITY_ID}"

# REGULATORY COMPLIANCE GUIDANCE:
# ─────────────────────────────────────────────────────────────────────────────
# Data Classification (use Purview sensitivity labels):
#   - Restricted: PII, PHI, payment data — row-level security required
#   - Confidential: Internal analytics, aggregated metrics
#   - Internal: General business data, non-sensitive
#
# Audit Requirements:
#   - All data access logged via Fabric audit logs
#   - Git history provides change audit trail
#   - Retention policies enforced via automated notebooks
#
# Access Control Patterns:
#   - Workspace roles: Admin → Member → Viewer (no direct data access)
#   - Row-level security (RLS) in Semantic Models for data-level restrictions
#   - Object-level security (OLS) to hide sensitive columns
#
# Supported Regulations:
#   - HIPAA: PII masking, audit logs, minimum necessary access
#   - SOX: Separation of duties, change management, retention
#   - GDPR: Data subject rights, right to erasure, consent tracking
#   - PCI-DSS: Encryption, access controls, network segmentation
