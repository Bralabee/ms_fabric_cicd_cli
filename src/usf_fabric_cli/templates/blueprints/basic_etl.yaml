# ─────────────────────────────────────────────────────────────────────────────
# Basic ETL Workspace Configuration Template
# Optimized for: Simple extract-transform-load data pipelines
# Use Cases: Departmental analytics, straightforward data processing
# Strategy: Git-sync-only — Fabric items managed through Git, not CLI
# ─────────────────────────────────────────────────────────────────────────────

workspace:
  name: "analytics-workspace"        # ← CHANGE: Your project workspace name
  display_name: "Analytics Workspace"
  description: "ETL workspace for data analytics"
  capacity_id: "${FABRIC_CAPACITY_ID}"
  domain: "${FABRIC_DOMAIN_NAME}"

  # Git Integration
  git_repo: "${GIT_REPO_URL}"
  git_branch: "main"
  git_directory: "/"

environments:
  dev:
    workspace:
      name: "analytics-workspace"
      capacity_id: "${FABRIC_CAPACITY_ID}"

# ── Folder Structure (Numbered Convention) ───────────────────────────────────
# Consistent across all workspaces for easy navigation and governance.
# ─────────────────────────────────────────────────────────────────────────────
folders:
  - "000 Orchestrate"
  - "100 Ingest"
  - "200 Store"
  - "300 Prepare"
  - "400 Model"
  - "500 Visualize"
  - "999 Libraries"
  - "Archive"

# ── Folder Rules (Post-Git-Sync Item Placement) ─────────────────────────────
# Fabric Git Sync always places items at the workspace root. After sync
# completes, these rules move items into their designated folders.
# ─────────────────────────────────────────────────────────────────────────────
folder_rules:
  - type: DataPipeline
    folder: "000 Orchestrate"
  - type: DataflowGen2
    folder: "000 Orchestrate"
  - type: Eventstream
    folder: "100 Ingest"
  - type: Lakehouse
    folder: "200 Store"
  - type: Notebook
    folder: "300 Prepare"
  - type: SparkJobDefinition
    folder: "300 Prepare"
  - type: Warehouse
    folder: "400 Model"
  - type: SemanticModel
    folder: "400 Model"
  - type: Report
    folder: "500 Visualize"
  - type: Dashboard
    folder: "500 Visualize"
  - type: Environment
    folder: "999 Libraries"

# ── No Fabric Items — Content Managed Through Git Sync ───────────────────────
# Items (lakehouses, notebooks, pipelines, etc.) are committed to Git and
# synced into the workspace automatically. The CLI only manages workspace
# structure, folders, principals, and deployment pipelines.
#
# Typical Git-managed items for a basic ETL project:
#   - Lakehouse: raw_data_lakehouse (200 Store)
#   - Lakehouse: processed_data_lakehouse (200 Store)
#   - Lakehouse: analytics_lakehouse (200 Store)
#   - Warehouse: analytics_warehouse (400 Model)
#   - Notebook: data_ingestion (300 Prepare)
#   - Notebook: data_transformation (300 Prepare)
#   - Pipeline: daily_etl_orchestrator (000 Orchestrate)
# ─────────────────────────────────────────────────────────────────────────────
lakehouses: []
notebooks: []
resources: []

# ── Access Control ───────────────────────────────────────────────────────────
principals:
  # 1. Automation Service Principal (runs deployments)
  - id: "${AZURE_CLIENT_ID}"
    role: Contributor
    description: "Automation SP — required for CI/CD deployments"

  # 2. Mandatory Admin security group (IT governance)
  - id: "${ADDITIONAL_ADMIN_PRINCIPAL_ID}"
    role: Admin
    description: "Mandatory governance admin group"

  # 3. Mandatory Contributor security group (support team)
  - id: "${ADDITIONAL_CONTRIBUTOR_PRINCIPAL_ID}"
    role: Contributor
    description: "Mandatory governance contributor group"

  # ── Project-specific principals (runtime-configurable via env vars) ────────
  # Replace with your project's secret names. Supports comma-separated GUIDs.
  - id: "${PROJECT_ADMIN_ID}"               # ← CHANGE: Your admin secret name
    role: Admin
    description: "Project admins — set via PROJECT_ADMIN_ID secret"

  - id: "${PROJECT_MEMBERS_ID}"             # ← CHANGE: Your member secret name
    role: Member
    description: "Project team members — set via PROJECT_MEMBERS_ID secret"

# ── Deployment Pipeline ──────────────────────────────────────────────────────
# Connects Dev → Test → Prod workspaces. Created automatically by
# `fabric-cicd deploy` during initial setup.
# ─────────────────────────────────────────────────────────────────────────────
deployment_pipeline:
  pipeline_name: "analytics-pipeline"    # ← CHANGE: Your pipeline name
  stages:
    development:
      workspace_name: "analytics-workspace"
      capacity_id: "${FABRIC_CAPACITY_ID}"
    test:
      workspace_name: "analytics-workspace [Test]"
      capacity_id: "${FABRIC_CAPACITY_ID}"
    production:
      workspace_name: "analytics-workspace [Production]"
      capacity_id: "${FABRIC_CAPACITY_ID}"

# Configuration Notes:
# 1. Replace all ← CHANGE markers with your project-specific values
# 2. Set required secrets: FABRIC_CAPACITY_ID, AZURE_CLIENT_ID, GIT_REPO_URL
# 3. Set project secrets: PROJECT_ADMIN_ID, PROJECT_MEMBERS_ID
# 4. Items are managed via Fabric Git Sync, not defined in this file
# 5. folder_rules automatically organize items after Git sync
# 6. Use `generate_project.py` to auto-customize this template
